# Build Documentation using MkDocs

name: CI

# Controls when the workflow will run
on:
  push:
    # Only run this job for tags with a valid semantic version
    tags:
      - 'v?(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?'
env:
  EXP: '^v?(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)(-([0-9a-zA-Z.-]*))?(\+([0-9a-zA-Z-]+(\.[0-9a-zA-Z-]+)*))?$'
  VERSION: $(echo $CI_COMMIT_TAG | sed -n -E "s/$EXP/\1.\2.\3\4/p")

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: 3.x
      - run: pip install mkdocs-material mike
      - run: mike deploy --push --update-aliases $VERSION latest
